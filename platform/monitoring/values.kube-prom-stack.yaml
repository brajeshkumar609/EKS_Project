# ==========================================================
# kube-prometheus-stack values (minimal)
# ==========================================================

# ---- Grafana (public access via Service: LoadBalancer) ----
grafana:
  enabled: true
  adminUser: admin
  adminPassword: "ChangeMeNow!"
  service:
    type: LoadBalancer
    port: 80
  persistence:
    enabled: false
  resources:
    requests:
      cpu: 100m
      memory: 200Mi
    limits:
      cpu: 400m
      memory: 600Mi

# ---- Alertmanager with Slack ----
alertmanager:
  enabled: true
  config:
    global:
      resolve_timeout: 5m
      slack_api_url: 'WEBHOOK_FROM_K8S_SECRET'
    route:
      group_by: ['alertname', 'namespace', 'severity']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 12h
      receiver: 'slack-alerts'
      routes:
        - match:
            severity: critical
          receiver: 'slack-alerts'
          repeat_interval: 1h
        - match:
            severity: warning
          receiver: 'slack-alerts'
          repeat_interval: 6h
    receivers:
      - name: 'slack-alerts'
        slack_configs:
          - channel: '#eks-graphana'
            send_resolved: true
            icon_emoji: ':bell:'
            username: 'EKS AlertManager'
            title: '{{ if eq .Status "firing" }} FIRING{{ else }} RESOLVED{{ end }} - {{ .CommonLabels.alertname }}'
            text: |
              *Alert:* {{ .CommonLabels.alertname }}
              *Severity:* {{ .CommonLabels.severity }}
              *Namespace:* {{ .CommonLabels.namespace }}
              {{ range .Alerts }}
              *Summary:* {{ .Annotations.summary }}
              *Description:* {{ .Annotations.description }}
              {{ end }}
    inhibit_rules:
      - source_match:
          severity: 'critical'
        target_match:
          severity: 'warning'
        equal: ['alertname', 'namespace']
  alertmanagerSpec:
    resources:
      requests:
        cpu: 100m
        memory: 100Mi
      limits:
        cpu: 200m
        memory: 200Mi

# ---- Prometheus settings ----
prometheus:
  enabled: true
  prometheusSpec:
    retention: 7d
    resources:
      requests:
        cpu: 200m
        memory: 400Mi
      limits:
        cpu: 500m
        memory: 1Gi
    ruleSelector:
      matchLabels:
        release: kube-prometheus-stack
    ruleSelectorNilUsesHelmValues: false

# ---- Prometheus Operator ----
prometheusOperator:
  enabled: true
  resources:
    requests:
      cpu: 100m
      memory: 100Mi
    limits:
      cpu: 200m
      memory: 200Mi

# ---- Node Exporter ----
nodeExporter:
  enabled: true

# ---- Kube State Metrics ----
kubeStateMetrics:
  enabled: true
